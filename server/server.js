const express = require("express");
const cors = require("cors");
const multer = require("multer");
const upload = multer();


const app = express();
const port = 5000;

app.use(cors());

// Fake license plate data
const data = {
  plates: [
    "А123ВС178", "В456НК78", "С789МР98", "Т234ОР77", "У567РТ47",
    "К890ХУ50", "Е345АН99", "Н678ВС23", "Р901МН42", "О234СР25",
    "А456ТР93", "М789УР02", "С012КН33", "В345ОР77", "Х678ЕА65",
    "Р901СХ89", "Т234НМ10", "К567УР21", "У890АН13", "Н345ВС54",
    "О678МР88", "А901ТР99", "Е234ХУ76", "Р567АН23", "С890КН45",
    "Т123ОР32", "Н456СХ78", "К789МН96", "У012ТР44", "М345УР11",
    "Р678АН19", "Е901ВС55", "О234МР01", "С567ТР67", "А890ХУ82",
    "К123АН77", "М456КН33", "В789ОР49", "Т012СХ98", "Н345МН76",
    "Р678ТР20", "С901УР57", "О234АН65", "А567ВС32", "К890МР89",
    "Е123ТР05", "Н456ХУ21", "Т789АН99", "М012КН47", "У345ОР85",
    "С678СХ78", "В901МН12", "Р234ТР32", "Н567УР66", "О890АН11",
    "К123ВС42", "Т456МР98", "А789ТР78", "М012ХУ23", "Е345АН45",
    "Р678КН99", "С901ОР77", "Н234СХ10", "О567МН56", "Т890ТР22",
    "К123УР78", "М456АН34", "В789ВС89", "Р012МР90", "С345ТР12",
    "О678ХУ32", "А901АН67", "Н234КН88", "Т567ОР55", "М890СХ21",
    "Р123МН33", "Е456ТР76", "С789УР24", "О012АН97", "К345ВС41",
    "Т678МР56", "А901ТР99", "Н234ХУ78", "М567АН35", "Р890КН45",
    "С123ОР10", "О456СХ66", "Т789МН55", "К012ТР98", "М345УР23",
    "Е678АН78", "Н901ВС21", "О234МР11", "С567ТР88", "Р890ХУ44",
    "А123АН77", "М456КН99", "В789ОР32", "Т012СХ78", "Н345МН45",
    "Р678ТР55", "С901УР98", "О234АН23", "А567ВС11", "К890МР77"
  ],
};

// Endpoint to receive images
app.post("/process-frame", upload.single('frame'), (req, res) => {
  if (!req.file) {
    return res.status(400).json({ error: "No file uploaded." });
  }

  const fileSizeInBytes = req.file.size;
  const randomPlate = data.plates[Math.floor(Math.random() * data.plates.length)];

  res.json({ plate: randomPlate, fileSize: fileSizeInBytes });
});

app.listen(port, () => {
  console.log(`Fast mock backend running at http://localhost:${port}`);
});
